# Android网络基础

## GET&POST介绍
* GET请求
> 优点:使用非常方便,只需要在url后面组拼数据.
> 
> 缺点:数据在url的后面组拼,不安全. 有数据长度限制.

* POST请求
> 优点: 安全,数据不是在url后面组拼而是通过流的方式写给服务器.数据长度不受限制
> 
> 缺点: 编写麻烦.
> 
> 真正的数据是通过流的方式写给服务器的
> 协议规定 POST 提交的数据必须放在消息主体（entity-body）中

post请求如果用get方式的话就会返回405错误

## GET&POST区别
- GET需要在url后面拼接参数，POST不拼接参数
- POST请求必须指定数据类型是一个经过url编码的表单数据`conn.setRequestProperty("Content-Type", "application/x-www-form-urlencoded");`
- POST请求必须指定提交数据的长度`conn.setRequestProperty("Content-Length", String.valueOf(data.length()));`

## 乱码问题
tomcat默认码表：iso-8859-1  如果这个码表里面没有就会采用本地码表
服务器或者客户端修改成一致的编码
提交数据使用URLEncoder来编码

## GET请求步骤
比较简单 直接看代码吧

	String path = "http://192.168.1.103:8080/web/LoginServlet?qq="+URLEncoder.encode(qq, "utf-8")+"&pwd="+URLEncoder.encode(pwd, "utf-8");
	URL url = new URL(path);
	HttpURLConnection conn = (HttpURLConnection) url.openConnection();
	conn.setRequestMethod("GET");
	conn.setConnectTimeout(5000);

## POST请求步骤
- 1.设置请求方式为POST
					
		conn.setRequestMethod("POST"); //注意单词必须大写.
- 2.设置http请求数据的类型为表单类型
					
		conn.setRequestProperty("Content-Type", "application/x-www-form-urlencoded");
					
- 3.设置给服务器写的数据的长度
					
		//qq=10000&pwd=abcde 使用URLEncoder来编码，防止乱码
		String data = "qq="+URLEncoder.encode(qq, "utf-8")+"&pwd="+URLEncoder.encode(pwd, "utf-8");
		conn.setRequestProperty("Content-Length", String.valueOf(data.length()));
					
- 4.记得指定要给服务器写数据
					
		conn.setDoOutput(true);
					
- 5.开始向服务器写数据
					
		conn.getOutputStream().write(data.getBytes());

# 使用HttpURLConnection还是HttpClient
> 下面代码来自网络，具体哪的忘了。

## HttpClient
Apache提供的高效的网络访问模块。

Android 2.2(API 8)及以前使用HttpClient比价好，bug少。

但是在[最新的Android版本中移除了](http://developer.android.com/about/versions/marshmallow/android-6.0-changes.html#behavior-apache-http-client)，如果你还想使用这个，在`build.gradle`里面添加：
	
	android {
	    useLibrary 'org.apache.http.legacy'
	}

### 具体使用方法：

	String urlAddress = "http://192.168.1.102:8080/qualityserver/login.do";  
	// 发送GET请求
	public String doGet(String username,String password){  
	    String getUrl = urlAddress + "?username="+username+"&password="+password;  
	    HttpGet httpGet = new HttpGet(getUrl);  
	    HttpParams hp = httpGet.getParams();  
	    hp.getParameter("true");  
	    HttpClient hc = new DefaultHttpClient();  
	    try {  
	        HttpResponse ht = hc.execute(httpGet);  
	        if(ht.getStatusLine().getStatusCode() == HttpStatus.SC_OK){  
	            HttpEntity he = ht.getEntity();  
	            InputStream is = he.getContent();  
	            BufferedReader br = new BufferedReader(new InputStreamReader(is));  
	            String response = "";  
	            String readLine = null;  
	            while((readLine =br.readLine()) != null){  
	                //response = br.readLine();  
	                response = response + readLine;  
	            }  
	            is.close();  
	            br.close();  
	              
	            //String str = EntityUtils.toString(he);  
	            System.out.println("========="+response);  
	            return response;  
	        }else{  
	            return "error";  
	        }  
	    } catch (ClientProtocolException e) {  
	        e.printStackTrace();  
	        return "exception";  
	    } catch (IOException e) {  
	        e.printStackTrace();  
	        return "exception";  
	    }      
	}  
	  
	public String doPost(String username,String password){  
	    //String getUrl = urlAddress + "?username="+username+"&password="+password;  
	    HttpPost httpPost = new HttpPost(urlAddress);  
	    List params = new ArrayList();  
	    NameValuePair pair1 = new BasicNameValuePair("username", username);  
	    NameValuePair pair2 = new BasicNameValuePair("password", password);  
	    params.add(pair1);  
	    params.add(pair2);  
	      
	    HttpEntity he;  
	    try {  
	        he = new UrlEncodedFormEntity(params, "gbk");  
	        httpPost.setEntity(he);  
	          
	    } catch (UnsupportedEncodingException e1) { 
	        e1.printStackTrace();  
	    }   
	      
	    HttpClient hc = new DefaultHttpClient();  
	    try {  
	        HttpResponse ht = hc.execute(httpPost);  
	        //连接成功  
	        if(ht.getStatusLine().getStatusCode() == HttpStatus.SC_OK){  
	            HttpEntity het = ht.getEntity();  
	            InputStream is = het.getContent();  
	            BufferedReader br = new BufferedReader(new InputStreamReader(is));  
	            String response = "";  
	            String readLine = null;  
	            while((readLine =br.readLine()) != null){  
	                //response = br.readLine();  
	                response = response + readLine;  
	            }  
	            is.close();  
	            br.close();  
	              
	            //String str = EntityUtils.toString(he);  
	            System.out.println("=========&&"+response);  
	            return response;  
	        }else{  
	            return "error";  
	        }  
	    } catch (ClientProtocolException e) {
	        e.printStackTrace();  
	        return "exception";  
	    } catch (IOException e) {
	        e.printStackTrace();  
	        return "exception";  
	    }     
	}

## HttpURLConnection
HttpURLConnection是一种多用途、轻量极的HTTP客户端，使用它来进行HTTP操作可以适用于大多数的应用程序。

### 注意事项
1. HttpURLConnection在Android 2.2及以前有一些bug。
2. 参看笔记：[Android 4.0 Ice Cream Sandwich GET请求变POST请求](https://github.com/chiahaolu/Notes/blob/master/Android%E7%BD%91%E7%BB%9C/2.Android%204.0%20GET%E8%AF%B7%E6%B1%82%E5%8F%98POST%E8%AF%B7%E6%B1%82.md)


### 具体使用方法：

	String urlAddress = "http://192.168.1.102:8080/AndroidServer/login.do";  
    URL url;  
    HttpURLConnection uRLConnection;  
 
    //向服务器发送get请求
    public String doGet(String username,String password){  
        String getUrl = urlAddress + "?username="+username+"&password="+password;  
        try {  
            url = new URL(getUrl);  
            uRLConnection = (HttpURLConnection)url.openConnection();  
            InputStream is = uRLConnection.getInputStream();  
            BufferedReader br = new BufferedReader(new InputStreamReader(is));  
            String response = "";  
            String readLine = null;  
            while((readLine =br.readLine()) != null){  
                //response = br.readLine();  
                response = response + readLine;  
            }  
            is.close();  
            br.close();  
            uRLConnection.disconnect();  
            return response;  
        } catch (MalformedURLException e) {  
            e.printStackTrace();  
            return null;  
        } catch (IOException e) {  
            e.printStackTrace();  
            return null;  
        }  
    }  
      
    //向服务器发送post请求
    public String doPost(String username,String password){  
        try {  
            url = new URL(urlAddress);  
            uRLConnection = (HttpURLConnection)url.openConnection();  
            uRLConnection.setDoInput(true);  
            uRLConnection.setDoOutput(true);  
            uRLConnection.setRequestMethod("POST");  
            uRLConnection.setUseCaches(false);  
            uRLConnection.setInstanceFollowRedirects(false);  
            uRLConnection.setRequestProperty("Content-Type", "application/x-www-form-urlencoded");  
            uRLConnection.connect();  
              
            DataOutputStream out = new DataOutputStream(uRLConnection.getOutputStream());  
            String content = "username="+username+"&password="+password;  
            out.writeBytes(content);  
            out.flush();  
            out.close();  
              
            InputStream is = uRLConnection.getInputStream();  
            BufferedReader br = new BufferedReader(new InputStreamReader(is));  
            String response = "";  
            String readLine = null;  
            while((readLine =br.readLine()) != null){  
                //response = br.readLine();  
                response = response + readLine;  
            }  
            is.close();  
            br.close();  
            uRLConnection.disconnect();  
            return response;  
        } catch (MalformedURLException e) {  
            e.printStackTrace();  
            return null;  
        } catch (IOException e) {  
            e.printStackTrace();  
            return null;  
        }  
    }

## 参考资料
http://blog.csdn.net/guolin_blog/article/details/12452307


